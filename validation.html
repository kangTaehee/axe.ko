<!DOCTYPE html>
<html lang="ko">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>U-CMS 접근성 자동검사 보고서</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<style>
        body {
            font-family: 'Inter',"Noto Sans KR",  sans-serif;
			font-optical-sizing: auto;
			font-weight: 400;
			font-style: normal;
            background-color: #f3f4f6; /* Light gray background */
        }
        .label-default { background-color: #6b7280; } /* Tailwind gray-500 */
        .label-info { background-color: #3b82f6; } /* Tailwind blue-500 */
        .label-warning { background-color: #f97316; } /* Tailwind orange-500 */
        .label-danger { background-color: #ef4444; } /* Tailwind red-500 */
        /* Styles for selected item */
        li.selected {
            border-color: #3b82f6; /* Tailwind blue-500 */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* Ring effect */
            background-color: #e0f2fe; /* Light blue background for selected */
        }
        /* Base styles for list items based on impact */
        li.critical {
            border-color: #f87171; /* red-300 */
            background-color: #fef2f2; /* red-50 */
        }
        li.serious {
            border-color: #fdba74; /* orange-300 */
            background-color: #fff7ed; /* orange-50 */
        }
        li.moderate {
            border-color: #93c5fd; /* blue-300 */
            background-color: #eff6ff; /* blue-50 */
        }
        li.minor {
            border-color: #fcd34d; /* yellow-300 */
            background-color: #fffbeb; /* yellow-50 */
        }
        /* Styling for the moreinfos-set section */
        .moreinfos-set {
            @apply mt-4 pt-4 border-t border-gray-200;
        }
        .moreinfos-set .description {
            @apply text-sm text-gray-700 mb-4 p-3 bg-gray-100 rounded-md;
        }
        .moreinfos-set ol {
            @apply list-decimal pl-5 space-y-3;
        }
        .moreinfos-set li.nodes {
            @apply text-sm text-gray-800 bg-white p-3 rounded-md shadow-sm;
        }
        .moreinfos-set li.nodes div {
            @apply flex items-center space-x-2 mb-2;
        }
        .moreinfos-set li.nodes code {
            @apply bg-gray-100 text-purple-700 p-1 rounded font-mono text-xs overflow-auto max-w-full;
        }
        .moreinfos-set li.nodes p {
            @apply text-gray-600 mt-2;
        }
        .moreinfos-set .btn {
            @apply inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500;
        }
    </style>
</head>

<body>
	<div class="p-6">
		<div id="app" class="mx-auto  bg-white rounded-lg shadow-xl p-6 md:p-8 ">
			<!-- Main content will be rendered by Vue.js if 'info' is available -->
			<div v-if="info">
				<h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-8 text-center leading-tight">
					U-CMS 접근성 자동검사
					<span class="text-red-600 block sm:inline mt-2 sm:mt-0">{{totallen}}가지의 지침 오류가 발견 되었습니다.</span>
				</h1>
				<div v-for="(규칙목록, 기준이름) in info" :key="기준이름" class="bg-gray-50 rounded-lg shadow-inner p-6 mb-6">
					<h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 pb-2 border-gray-200">
						{{ 기준이름 }}
					</h2>
					<ul class="space-y-4">
						<li :class="[item.impact, {selected : item.selected}]" v-for="(item, i) in 규칙목록" :key="i" class="flex flex-col rounded-lg shadow-sm transition-all duration-300 ease-in-out hover:bg-opacity-15 focus:outline-none focus:ring-2 focus:ring-opacity-50">
							<button @click="qaopen(i, 기준이름)" class="flex flex-grow w-full sm:w-auto text-left py-2 px-3 rounded-md transition duration-200 ease-in-out">
								<span class="txt flex items-center space-x-3">
									<span class="px-3 py-1 text-sm font-semibold text-white rounded-full" :class="{
                                          'label-default': item.impact=='minor',
                                          'label-info': item.impact=='moderate',
                                          'label-warning': item.impact=='serious',
                                          'label-danger': item.impact=='critical'
                                      }">
										{{ item.impact == 'minor' ? '경고' : item.impact == 'moderate' ? '경고' : item.impact == 'serious' ? '위험' : '심각' }}
									</span>
									<span class="text-gray-800 text-base leading-snug">{{item.help}}</span>
								</span>
								<span class="badge ml-auto mt-2 sm:mt-0 px-3 py-1 text-sm font-bold rounded-full" :class="{
                                    'text-red-800 bg-red-200': item.impact=='critical',
                                    'text-orange-800 bg-orange-200': item.impact=='serious',
                                    'text-blue-800 bg-blue-200': item.impact=='moderate',
                                    'text-yellow-800 bg-yellow-200': item.impact=='minor'
                                  }">
									{{item.nodes?.length || 0}}
								</span>
							</button>
							<!-- 
							<a :href="item.helpUrl" target="_blank" rel="noopener" class="text-blue-600 hover:underline mt-2 sm:mt-0 sm:ml-4 flex-shrink-0 text-sm">
								도움말
							</a>
							-->
							<!-- Detailed info section, visible only when selected -->
							<div class="moreinfos-set w-full" v-if="item.selected && item.nodes && item.nodes.length > 0">

								<div class="px-4 pt-2 flex items-center bg-blue-50 border border-blue-200 text-blue-700 rounded-md p-3 mx-2" v-if="item.description">
									<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
										<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
									</svg>
									<div>{{item.description}}</div>
								</div>
								<ol>
									<li v-for="node in item.nodes" :key="node.html" class="p-4 nodes **mb-4 border-b border-gray-200**">
										<div>
											<button class="px-3 py-1 text-sm font-semibold text-white rounded-full label-default focus:ring-opacity-50 hover:bg-[#ef4444]" :onclick="'targetoutline(\''+node.target[0]+'\')'">대상 보기</button>
											<code>{{node.html}}</code>
										</div>
										<p v-html='node.failureSummary.replace(/(?:\r\n|\r|\n)/g, "<br>")'></p>
									</li>
								</ol>
							</div>
							<div v-else-if="item.selected && (!item.nodes || item.nodes.length === 0)" class="moreinfos-set w-full">
								<div class="description text-center text-gray-500">
									이 항목에 대한 세부 노드 정보가 없습니다.
								</div>
							</div>
						</li>
						<!-- Message for categories with no issues -->
						<li v-if="규칙목록.length === 0" class="text-gray-500 text-center py-4">
							해당 지침에서 발견된 오류가 없습니다.
						</li>
					</ul>
				</div>
			</div>
			<!-- Loading or empty state message -->
			<div v-else class="text-center py-10 text-gray-600">
				데이터를 불러오는 중입니다...
			</div>
		</div>
	</div>
	<!-- <script src="/static/axe/role.js"></script> -->
	<script>
		const role = {
			"WAIA001": {
				description: "1.적절한 대체 텍스트 제공",
				checks: ["area-alt", "image-alt", "input-image-alt", "object-alt", "role-img-alt", "svg-img-alt", "aria-command-name", "aria-tooltip-name", "aria-toggle-field-name", "aria-treeitem-name", "button-name", "image-redundant-alt", "input-button-name", "aria-label", "button-has-visible-text", "has-alt", "has-visible-text", "non-empty-alt"]
			},
			"WAIA002": {
				description: "2.자막 제공",
				checks: ["audio-caption", "video-caption"]
			},
			"WAIA003": {
				description: "3.표의 구성",
				checks: ["definition-list", "dlitem", "scope-attr-valid", "table-duplicate-name", "table-fake-caption", "td-has-header", "td-headers-attr", "th-has-data-cells", "empty-table-header", "caption-faked", "html5-scope", "same-caption-summary", "scope-value", "td-has-header", "td-headers-attr", "th-has-data-cells"]
			},
			"WAIA004": {
				description: "4.콘텐츠의 선형 구조",
				checks: ["focus-order-semantics"]
			},
			"WAIA005": {
				description: "5.명확한 지시 사항 제공",
				checks: ["label-content-name-mismatch", "label-title-only"]
			},
			"WAIA006": {
				description: "6.색에 무관한 콘텐츠 인식",
				checks: ["link-in-text-block"]
			},
			"WAIA007": {
				description: "7.자동 재생 금지",
				checks: ["no-autoplay-audio"]
			},
			"WAIA008": {
				description: "8.텍스트 콘텐츠의 명도 대비",
				checks: ["color-contrast"]
			},
			"WAIA009": {
				description: "9.콘텐츠 간의 구분",
				checks: ["contentinfo", "important-letter-spacing", "important-line-height", "important-word-spacing", "letter-spacing", "line-height", "word-spacing"]
			},
			"WAIA010": {
				description: "10.키보드 사용 보장",
				checks: ["aria-hidden-focus", "keyboard-navigation"]
			},
			"WAIA011": {
				description: "11.초점 이동과 표시",
				checks: ["frame-focusable-content"]
			},
			"WAIA012": {
				description: "12.조작 가능",
				checks: ["scrollable-region-focusable", "nested-interactive", "is-on-screen"]
			},
			"WAIA013": {
				description: "13.문자 단축키",
				checks: []
			},
			"WAIA014": {
				description: "14.응답시간 조절",
				checks: ["meta-refresh", "meta-refresh-no-exceptions"]
			},
			"WAIA015": {
				description: "15.정지 기능 제공",
				checks: ["pause-stop-hide"]
			},
			"WAIA016": {
				description: "16.깜빡임과 번쩍임 사용 제한",
				checks: []
			},
			"WAIA017": {
				description: "17.반복 영역 건너뛰기",
				checks: ["bypass", "skip-link"]
			},
			"WAIA018": {
				description: "18.제목 제공",
				checks: ["document-title", "heading-order", "empty-heading", "p-as-heading", "unique-frame-title", "doc-has-title"]
			},
			"WAIA019": {
				description: "19.적절한 링크 텍스트",
				checks: ["identical-links-same-purpose", "link-name"]
			},
			"WAIA020": {
				description: "20.고정된 참조 위치 정보",
				checks: ["landmark-main-is-top-level"]
			},
			"WAIA021": {
				description: "21.단일 포인터 입력 지원",
				checks: []
			},
			"WAIA022": {
				description: "22.포인터 입력 취소",
				checks: ["pointer-cancel"]
			},
			"WAIA023": {
				description: "23.레이블과 네임",
				checks: []
			},
			"WAIA024": {
				description: "24.동작 기반 작동",
				checks: []
			},
			"WAIA025": {
				description: "25.기본 언어 표시",
				checks: ["html-has-lang", "html-lang-valid", "valid-lang", "html-xml-lang-mismatch"]
			},
			"WAIA026": {
				description: "26.사용자 요구에 따른 실행",
				checks: []
			},
			"WAIA027": {
				description: "27.찾기 쉬운 도움 정보",
				checks: ["frame-title", "frame-title-unique"]
			},
			"WAIA028": {
				description: "28.오류 정정",
				checks: ["autocomplete-valid"]
			},
			"WAIA029": {
				description: "29.레이블 제공",
				checks: ["label", "form-field-multiple-labels", "aria-input-field-name", "aria-metre-name", "aria-progressbar-name", "label-content-name-mismatch", "label-title-only", "aria-labelledby", "non-empty-title"]
			},
			"WAIA030": {
				description: "30.접근 가능한 인증",
				checks: []
			},
			"WAIA031": {
				description: "31.반복 입력 정보",
				checks: []
			},
			"WAIA032": {
				description: "32.마크업 오류 방지",
				checks: ["duplicate-id-aria", "duplicate-id-active", "duplicate-id", "duplicate-id-aria"]
			},
			"WAIA033": {
				description: "33.웹 애플리케이션 접근성 준수",
				checks: ["frame-tested", "aria-allowed-attr"]
			},
			"WAIAE01": {
				description: "기타 ARIA 관련",
				checks: ["aria-allowed-role", "aria-prohibited-attr", "aria-required-attr", "aria-conditional-attr", "aria-deprecated-role", "aria-dialog-name", "aria-hidden-body", "aria-meter-name", "aria-required-children", "aria-required-parent", "aria-roledescription", "aria-roles", "aria-text", "aria-valid-attr-value", "aria-valid-attr"]
			},
			"WAIAE02": {
				description: "기타 시맨틱 관련",
				checks: ["list", "listitem", "definition-list", "dlitem", "hidden-content", "landmark-banner-is-top-level", "landmark-complementary-is-top-level", "landmark-contentinfo-is-top-level", "landmark-main-is-top-level", "landmark-no-duplicate-banner", "landmark-no-duplicate-contentinfo", "landmark-no-duplicate-main", "landmark-one-main", "landmark-unique", "marquee", "blink", "region", "exists", "presentational-role", "role-none", "role-presentation", "svg-non-empty-title"]
			},
			"WAIAE03": {
				description: "기타 스타일 및 구조 관련",
				checks: ["css-orientation-lock", "p-as-heading", "avoid-inline-spacing"]
			},
			"WAIAE04": {
				description: "기타 프레임 관련",
				checks: ["hidden-content"]
			}
		}
		const report = {};
		function checkVideoCaption(item) {
			for (const key in role) {
				if (role[key].checks.includes(item)) { return key }
			}
			return null
		}
	</script>
	<script>
		window.addEventListener('message', (event) => {
			// 보안을 위해 송신처(origin) 확인 필수
			// if (event.origin !== "https://unpl.co.kr") return;

			if (event.data.type === 'VALIDATION') {
				console.log('받은 데이터:', event.data.data);
				// 여기서 validationdata 처리를 진행하세요.
				init(event.data.data)
			}
		}, false);
	</script>
	<script>
		function targetoutline(target) {
			// if (prevtarget) opener.document.querySelector(prevtarget).style.outline = 'none';
			// opener.document.querySelector(target).style.outline = '2px dotted #000';
			// opener.document.querySelector(target).scrollIntoView();
			// prevtarget = target;
			opener.postMessage({ type: 'ERRNODETARGET', data: target }, axedata.openerOrigin);

			opener.focus
		}
		let axedata 
		function init(openerdata) {
			axedata = openerdata

			// delete role['WAIAE01'];
			// delete role['WAIAE02'];
			// delete role['WAIAE03'];
			// delete role['WAIAE04'];
			var prevtarget = null;

			var validationdatas = [...openerdata.violations, ...openerdata.incomplete]
			validationdatas.forEach(function (obj) {
				obj.selected = false;
			});
			const 결과 = {}
			for (const 기준Key in role) {
				const 기준Tags = role[기준Key].checks;
				결과[role[기준Key].description] = []; // Initialize an empty array for each criteria key
				for (const dataEntry of validationdatas) {
					const dataTags = dataEntry.id;
					const hasMatchingTag = 기준Tags.includes(dataEntry.id);
					if (hasMatchingTag) {
						결과[role[기준Key].description].push(dataEntry);
					}
				}
			}
			console.log(결과)
			// 1. data의 키에 값이 없는 요소는 삭제한다.
			for (const key in 결과) {
				if (결과.hasOwnProperty(key)) {
					if (결과[key].length === 0) {
						delete 결과[key];
					}
				}
			}
			// 2. 값이 있는 키의 수를 구한다.
			const numberOfKeysWithValue = Object.keys(결과).length;
			var app = new Vue({
				el: '#app',
				data() {
					return {
						info: 결과,
						totallen: numberOfKeysWithValue
					}
				},
				methods: {
					qaopen: function (i, key) {
						let 기준 = this.info
						for (const key in 기준) {
							// Check if the property belongs to the object itself (good practice)
							if (기준.hasOwnProperty(key)) {
								const array = 기준[key];
								// Iterate over the array associated with each key
								for (let i = 0; i < array.length; i++) {
									// Set the 'selected' property to false for each object in the array
									array[i].selected = false;
								}
							}
						}
						this.info[key][i].selected = true;
					}
				},
			})

		}
	</script>
</body>

</html>